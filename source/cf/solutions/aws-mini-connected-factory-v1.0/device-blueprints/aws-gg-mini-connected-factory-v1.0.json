{
    "id": "aws-gg-mini-connected-factory-v1.0",
    "name": "AWS Greengrass Mini Connected Factory v1.0",
    "type": "GREENGRASS",
    "compatibility": ["aws-deeplens-v1.0"],
    "deviceTypeMappings": [{
        "substitute": "ARTIFACTS",
        "value": {
            "aws-deeplens-v1.0": "artifacts"
        }
    }, {
        "substitute": "AWS_CAM_HOME",
        "value": {
            "aws-deeplens-v1.0": "aws_cam_home"
        }
    }, {
        "substitute": "AWS_CAM_STREAM",
        "value": {
            "aws-deeplens-v1.0": "aws_cam_stream"
        }
    }],
    "spec": {
        "CoreDefinitionVersion": {
            "Cores": [{
                "SyncShadow": true,
                "ThingArn": "[CORE_ARN]",
                "CertificateArn": "[CORE_CERTIFICATE_ARN]"
            }]
        },
        "FunctionDefinitionVersion": {
            "Functions": [{
                    "FunctionArn": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-camera-python:MTM",
                    "FunctionConfiguration": {
                        "EncodingType": "json",
                        "Environment": {
                            "AccessSysfs": false,
                            "ResourceAccessPolicies": [{
                                    "Permission": "rw",
                                    "ResourceId": "tmp"
                                },
                                {
                                    "Permission": "rw",
                                    "ResourceId": "model-lego-helmets"
                                },
                                {
                                    "Permission": "ro",
                                    "ResourceId": "[AWS_CAM_HOME]"
                                },
                                {
                                    "Permission": "ro",
                                    "ResourceId": "[AWS_CAM_STREAM]"
                                },
                                {
                                    "Permission": "ro",
                                    "ResourceId": "[ARTIFACTS]"
                                }
                            ],
                            "Variables": {
                                "ML_MODEL_PATH": "/ml/helmets/image-classification"
                            }
                        },
                        "MemorySize": 1048576,
                        "Pinned": true,
                        "Timeout": 25
                    }
                },
                {
                    "FunctionArn": "arn:aws:lambda:::function:GGIPDetector:1",
                    "FunctionConfiguration": {
                        "MemorySize": 32768,
                        "Environment": {
                            "Variables": {},
                            "AccessSysfs": true
                        },
                        "Pinned": true,
                        "Timeout": 3
                    }
                },
                {
                    "FunctionArn": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-belt-serial-python:MTM",
                    "FunctionConfiguration": {
                        "EncodingType": "json",
                        "Environment": {
                            "ResourceAccessPolicies": [{
                                "Permission": "rw",
                                "ResourceId": "serial-port"
                            }],
                            "Variables": {
                                "SERIALPORT_PORT": "/dev/ttyUSB0",
                                "SERIALPORT_SPEED": "115200"
                            }
                        },
                        "MemorySize": 131072,
                        "Pinned": true,
                        "Timeout": 3
                    }
                }
            ]
        },
        "LoggerDefinitionVersion": {
            "Loggers": [{
                    "Type": "AWSCloudWatch",
                    "Level": "INFO",
                    "Id": "aws-gg-mini-connected-factory-AWSCloudWatch-GreengrassSystem",
                    "Component": "GreengrassSystem"
                },
                {
                    "Type": "AWSCloudWatch",
                    "Level": "INFO",
                    "Id": "aws-gg-mini-connected-factory-AWSCloudWatch-Lambda",
                    "Component": "Lambda"
                },
                {
                    "Space": 300000,
                    "Type": "FileSystem",
                    "Level": "INFO",
                    "Id": "aws-gg-mini-connected-factory-FileSystem-GreengrassSystem",
                    "Component": "GreengrassSystem"
                },
                {
                    "Space": 300000,
                    "Type": "FileSystem",
                    "Level": "INFO",
                    "Id": "aws-gg-mini-connected-factory-FileSystem-Lambda",
                    "Component": "Lambda"
                }
            ]
        },
        "ResourceDefinitionVersion": {
            "Resources": [{
                "Id": "serial-port",
                "Name": "serial-port",
                "ResourceDataContainer": {
                    "LocalDeviceResourceData": {
                        "GroupOwnerSetting": {
                            "AutoAddGroupOwner": false,
                            "GroupOwner": "dialout"
                        },
                        "SourcePath": "/dev/ttyUSB0"
                    }
                }
            }, {
                "Id": "model-lego-helmets",
                "Name": "mtm-model-lego-model",
                "ResourceDataContainer": {
                    "S3MachineLearningModelResourceData": {
                        "DestinationPath": "/ml/helmets/",
                        "S3Uri": "[DATA_BUCKET_S3_URL]/AMCF1/models/legomodel.tar.gz"
                    }
                }
            }, {
                "Id": "tmp",
                "Name": "tmp",
                "ResourceDataContainer": {
                    "LocalVolumeResourceData": {
                        "DestinationPath": "/tmp",
                        "GroupOwnerSetting": {
                            "AutoAddGroupOwner": true
                        },
                        "SourcePath": "/tmp"
                    }
                }
            }]
        },
        "SubscriptionDefinitionVersion": {
            "Subscriptions": [{
                    "Source": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-camera-python:MTM",
                    "Subject": "mtm/[CORE]/inference",
                    "Target": "cloud"
                },
                {
                    "Id": "80d583ed-44f1-4d1a-b61b-024cf8791bcc",
                    "Source": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-camera-python:MTM",
                    "Subject": "mtm/[CORE]/admin",
                    "Target": "cloud"
                },
                {
                    "Id": "b587282f-2bc2-4624-b2d7-ae240fd31d98",
                    "Source": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-camera-python:MTM",
                    "Subject": "$aws/things/[CORE]/shadow/update",
                    "Target": "cloud"
                },
                {
                    "Id": "b86dc911-b2db-4a17-a6b7-83c91d15cf69",
                    "Source": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-camera-python:MTM",
                    "Subject": "$aws/things/[CORE]/shadow/update",
                    "Target": "GGShadowService"
                }
            ]
        }
    }
}
