{
    "id": "aws-gg-mini-connected-factory-v1.0",
    "name": "AWS Greengrass Mini Connected Factory v1.0",
    "type": "GREENGRASS",
    "compatibility": ["aws-deeplens-v1.0"],
    "deviceTypeMappings": [{
        "substitute": "ARTIFACTS",
        "value": {
            "aws-deeplens-v1.0": "artifacts"
        }
    }],
    "spec": {
        "CoreDefinitionVersion": {
            "Cores": [{
                "SyncShadow": true,
                "ThingArn": "[CORE_ARN]",
                "CertificateArn": "[CORE_CERTIFICATE_ARN]"
            }]
        },
        "FunctionDefinitionVersion": {
            "Functions": [{
                    "FunctionArn": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:deeplens_admin_model_downloader:1",
                    "FunctionConfiguration": {
                        "MemorySize": 160000,
                        "Environment": {
                            "Variables": {},
                            "AccessSysfs": true,
                            "ResourceAccessPolicies": [{
                                "Permission": "rw",
                                "ResourceId": "[ARTIFACTS]"
                            }]
                        },
                        "Executable": "das_mutter.function_handler",
                        "Pinned": true,
                        "Timeout": 1200
                    }
                },
                {
                    "FunctionArn": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-camera-python:MTM",
                    "FunctionConfiguration": {
                        "EncodingType": "json",
                        "Environment": {
                            "AccessSysfs": false,
                            "ResourceAccessPolicies": [{
                                    "Permission": "rw",
                                    "ResourceId": "tmp"
                                },
                                {
                                    "Permission": "ro",
                                    "ResourceId": "aws_cam_home"
                                },
                                {
                                    "Permission": "ro",
                                    "ResourceId": "stream"
                                },
                                {
                                    "Permission": "rw",
                                    "ResourceId": "model-lego-helmets"
                                },
                                {
                                    "Permission": "ro",
                                    "ResourceId": "artifacts"
                                },
                                {
                                    "Permission": "rw",
                                    "ResourceId": "26574346-54fe-4ba9-a7f0-b742e59ebf45"
                                },
                                {
                                    "Permission": "rw",
                                    "ResourceId": "b4a7f129-4e9b-4498-8f6a-3781986db374"
                                },
                                {
                                    "Permission": "rw",
                                    "ResourceId": "42650a24-8c63-47ec-843e-16721b0868e1"
                                }
                            ],
                            "Variables": {
                                "ML_MODEL_PATH": "/ml/helmets/image-classification"
                            }
                        },
                        "MemorySize": 1048576,
                        "Pinned": true,
                        "Timeout": 25
                    }
                },
                {
                    "FunctionArn": "arn:aws:lambda:::function:GGIPDetector:1",
                    "FunctionConfiguration": {
                        "MemorySize": 32768,
                        "Environment": {
                            "Variables": {},
                            "AccessSysfs": true
                        },
                        "Pinned": true,
                        "Timeout": 3
                    }
                },
                {
                    "FunctionArn": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:deeplens_admin_version_poller:1",
                    "FunctionConfiguration": {
                        "MemorySize": 160000,
                        "Environment": {
                            "Variables": {},
                            "AccessSysfs": true,
                            "ResourceAccessPolicies": [{
                                "Permission": "rw",
                                "ResourceId": "[ARTIFACTS]"
                            }]
                        },
                        "Executable": "version_poller.function_handler",
                        "Pinned": true,
                        "Timeout": 1200
                    }
                }
            ]
        },
        "LoggerDefinitionVersion": {
            "Loggers": [{
                    "Type": "AWSCloudWatch",
                    "Level": "INFO",
                    "Id": "deeplens-greengrass-AWSCloudWatch-GreengrassSystem",
                    "Component": "GreengrassSystem"
                },
                {
                    "Type": "AWSCloudWatch",
                    "Level": "INFO",
                    "Id": "deeplens-greengrass-AWSCloudWatch-Lambda",
                    "Component": "Lambda"
                },
                {
                    "Space": 300000,
                    "Type": "FileSystem",
                    "Level": "INFO",
                    "Id": "deeplens-greengrass-FileSystem-GreengrassSystem",
                    "Component": "GreengrassSystem"
                },
                {
                    "Space": 300000,
                    "Type": "FileSystem",
                    "Level": "INFO",
                    "Id": "deeplens-greengrass-FileSystem-Lambda",
                    "Component": "Lambda"
                }
            ]
        },
        "ResourceDefinitionVersion": {
            "Resources": [{
                "Id": "serialport",
                "Name": "serialport",
                "ResourceDataContainer": {
                    "LocalDeviceResourceData": {
                        "GroupOwnerSetting": {
                            "AutoAddGroupOwner": false,
                            "GroupOwner": "dialout"
                        },
                        "SourcePath": "/dev/ttyUSB0"
                    }
                }
            }, {
                "Id": "model-lego-helmets",
                "Name": "model-lego-model",
                "ResourceDataContainer": {
                    "S3MachineLearningModelResourceData": {
                        "DestinationPath": "/ml/helmets/",
                        "S3Uri": "https://connected-factory-reinvent.s3.amazonaws.com/model.tar.gz"
                    }
                }
            }]
        },
        "SubscriptionDefinitionVersion": {
            "Subscriptions": [{
                    "Target": "cloud",
                    "Source": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:deeplens_admin_model_downloader:1",
                    "Subject": "$aws/things/[THING_NAME]/shadow/update"
                },
                {
                    "Target": "cloud",
                    "Source": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:deeplens_admin_version_poller:1",
                    "Subject": "$aws/things/[THING_NAME]/shadow/update"
                }
            ]
        },
        "IAM": {
            "GreengrassGroupRole": {
                "PolicyArns": [
                    "[DATA_BUCKET_ACCESS_POLICY]"
                ]
            }
        }
    }
}
