{
    "id": "aws-gg-mini-connected-factory-v1.1",
    "name": "GG Mini Connected Factory v1.1",
    "type": "GREENGRASS",
    "compatibility": ["aws-deeplens-v1.0"],
    "deviceTypeMappings": [{
        "substitute": "AWS_CAM_STREAM",
        "value": {
            "aws-deeplens-v1.0": "stream"
        }
    }],
    "spec": {
        "FunctionDefinitionVersion": {
            "Functions": [{
                    "FunctionArn": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-camera-python:MTM",
                    "FunctionConfiguration": {
                        "EncodingType": "json",
                        "Environment": {
                            "AccessSysfs": false,
                            "ResourceAccessPolicies": [{
                                    "Permission": "rw",
                                    "ResourceId": "tmp"
                                },
                                {
                                    "Permission": "rw",
                                    "ResourceId": "mtm-model-lego-helmets"
                                },
                                {
                                    "Permission": "ro",
                                    "ResourceId": "[AWS_CAM_STREAM]"
                                },
                                {
                                    "Permission": "rw",
                                    "ResourceId": "gpu"
                                }
                            ],
                            "Variables": {
                                "ML_MODEL_PATH": "/ml/helmets/image-classification"
                            }
                        },
                        "MemorySize": 1048576,
                        "Pinned": true,
                        "Timeout": 25
                    }
                }
            ]
        },
        "ResourceDefinitionVersion": {
            "Resources": [{
                "Id": "mtm-model-lego-helmets",
                "Name": "mtm-model-lego-helmets",
                "ResourceDataContainer": {
                    "S3MachineLearningModelResourceData": {
                        "DestinationPath": "/ml/helmets/",
                        "S3Uri": "[DATA_BUCKET_S3_URL]/aws-mini-connected-factory-v1.0/models/legomodel.tar.gz"
                    }
                }
            }]
        },
        "SubscriptionDefinitionVersion": {
            "Subscriptions": [{
                    "Source": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-camera-python:MTM",
                    "Subject": "mtm/[CORE]/inference",
                    "Target": "cloud"
                },
                {
                    "Source": "arn:aws:lambda:[AWS_REGION]:[AWS_ACCOUNT]:function:aws-mini-connected-factory-camera-python:MTM",
                    "Subject": "mtm/[CORE]/admin",
                    "Target": "cloud"
                }
            ]
        }
    }
}
